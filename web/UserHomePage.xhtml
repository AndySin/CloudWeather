<?xml version="1.0" encoding="UTF-8"?>
<!--
Created by Tanya Sutan-Tanon on 2017.04.20 
Copyright © 2017 Osman Balci. All rights reserved.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <!-- This page is constructed based on the siteTemplate -->
    <ui:composition template="/template/siteTemplate.xhtml" >

        <ui:define name="editableContent" >


            <h:form prependId="false">
                <div class="latlng" style="display:none;">
                    <h:inputText id="searchQueryFieldLat"
                                 value="#{searchedWeatherController.searchLatitude}">
                    </h:inputText>

                    <h:inputText id="searchQueryFieldLng"
                                 value="#{searchedWeatherController.searchLongitude}">
                    </h:inputText>
                </div>

                <script>
                    var lat = document.getElementById("searchQueryFieldLat");
                    var lng = document.getElementById("searchQueryFieldLng");
                    function getLocation() {
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition(showPosition);
                        }
                    }

                    function showPosition(position) {
                        lat.value = position.coords.latitude;
                        lng.value = position.coords.longitude;
                    }

                    window.onload = getLocation();
                </script>


                <h:commandButton id="checkWeatherButton" value="CHECK" action="#{searchedWeatherController.getCurrentlyForecast()}" style="display:none;">
                    <f:ajax execute="@form" render="result result2" />
                </h:commandButton>
            </h:form>

            <script>
                var button = document.getElementById("checkWeatherButton");
                setTimeout(function () {
                    button.click();
                }, 100);
            </script>

            <div id="topMain">
                <p:panelGrid id="result" columns="2" style="width:100%;margin:10px 0px;" columnClasses="weatherResults,weatherResults" layout="grid" styleClass="ui-panelgrid-blank">
                    <f:facet name="header">
                        <h:outputText styleClass="weatherResults" value="#{searchedWeatherController.result.currently.date}"/>
                        <br/>
                        <p:graphicImage url="resources/images/weatherIcons/#{searchedWeatherController.result.currently.icon}.png"/>
                    </f:facet>

                    <h:outputText value="Temperatue:" />
                    <h:outputText value="#{searchedWeatherController.result.currently.temperature.intValue()}°F"/>

                    <h:outputText value="Precipitation:" />
                    <h:outputText value="#{searchedWeatherController.result.currently.precipProbability * 100}%"/>

                    <h:outputText value="Humidity:" />
                    <h:outputText value="#{searchedWeatherController.result.currently.humidity * 100}%"/>

                    <h:outputText value="Wind:" />
                    <h:outputText value="#{searchedWeatherController.result.currently.windBearing} #{searchedWeatherController.result.currently.windSpeed} mph"/>
                </p:panelGrid>

                <p:panelGrid id="result2" columns="1" style="width:100%;margin:10px 0px;" columnClasses="weatherResults,weatherResults" layout="grid" styleClass="ui-panelgrid-blank">
                    <f:facet name="header">
                        <h:outputText styleClass="weatherResults" value="Weather Alerts for Your Area"/>
                    </f:facet>

                    <p:carousel value="#{searchedWeatherController.result.alerts}" headerText="Alerts" var="item" itemStyle="text-align:center" responsive="true" style="font-size: 18px" numVisible="5" >
                        <p:panelGrid columns="2" style="width:100%;margin:10px 0px;" columnClasses="weatherResults,weatherResults" layout="grid" styleClass="ui-panelgrid-blank">

                            <h:outputText value="Summary:" />
                            <h:outputText value="#{item.description}"/>

                            <h:outputText value="Severity:" />
                            <h:outputText value="#{item.severity}"/>

                            <h:outputText value="Source:" />
                            <h:outputText value="#{item.uri}"/>

                        </p:panelGrid>
                    </p:carousel>
                </p:panelGrid>
            </div>

        </ui:define>

    </ui:composition>

</html>

